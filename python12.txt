Калинин Владимир (ментор)  6 days ago
@channel Уважаемые студенты!
Приглашаю принять участие во вводном вебинаре, посвященном EDA и итоговому проекту юнита 2.
На вебинаре поговорим о разведывательном анализе. Будут даны рекомендации по выполнению проекта. Отработаем имеющиеся вопросы. Вебинар для всех, кто уже начал или планирует начать итоговый проект по EDA.
Вводный вебинар сегодня в 12:00 по МСК.
Ссылка на вебинар:
https://us02web.zoom.us/j/89577197461?pwd=bUdYa1p3NjJ0ditZUDgrTzdXb3dEZz09






Alexander Pro  5 days ago
@Калинин Владимир (ментор) Здравствуйте! А где можно найти запись вебинара? (edited) 

Олег Малаев  5 days ago
День добрый !

Олег Малаев  5 days ago
А как можно заранее узнавать о вебинарах?
Да и где есть запись этого и предыдущих по EDA?


День добрый, Анастасия!
А как можно заранее узнавать о вебинарах?

Проходил вебинар 6 марта о разведывательном анализе и  посвященный EDA и итоговому проекту юнита 2.
Вел его Калинин Владимир.
Где есть запись этого и предыдущих по EDA?
STAT&BASIC по этим разделам кому задать вопрос? Может планируются или есть вебинары по этим разделам.



Алёшин Иван Today at 11:08 AM
Добрый день, есть вопросик по работе с pandas. Имеется две колонки, нужно изменить некоторые данные во второй колонке в зависимости от данных в первой. Например нужно проверить, чтобы во второй колонке значение было меньше, чем в первой. Если больше, то умножить на -1 (для примера)
Как вариант - делаю через цикл, но не думаю, что это самое красивое и быстрое для вычисления решение.
import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(6, 2), columns=list("AB"))
for i in range(len(df)):
     if df['B'][i] > df['A'][i]:
            df['B'][i] = df['B'][i] * -1
(edited)




5 replies

Sergey Meshcheryakov  10 hours ago
Добрый день.
import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(6, 2), columns=list("AB"))
display(df)
df['B'] = df[['A','B']].apply(lambda x: -x[1] if x[1]>x[0] else x[1],axis=1)
df

Алёшин Иван  9 hours ago
Cпасибо)

TatianaK  8 hours ago
@Sergey Meshcheryakov подскажите пожалуйста что делает в данном случае axis=1 и почему без него весь второй столбец превратился в NaN

Sergey Meshcheryakov  6 hours ago
@TatianaK добрый день. Параметр axis отвечает за ось, по которой будут браться значения. По умолчанию этот параметр равен 0.
В случае, когда axis=0, функция apply сначала берет все значения из столбца A (серию значений) и передает их внутрь, т.е. в func, func после выполнения возвращает одно число, в зависимости от выполнения/не выполнения условия. Далее, тоже самое со столбцом B. По итогу выполнения мы имеем два числа, которые не понятно каким образом разместить в столбце С. Отсюда и NaN  в столбце.
import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(6, 2), columns=list("AB"))
print(df,'\n')
def func(x):
    print('значения, переданные из apply:','\n',x, type(x),'\n')
    if x[1]>x[0]:
        print('возвращаемое значение:', -x[1],'\n')
        return -x[1]
    else:
        print('возвращаемое значение:', -x[1],'\n')
        return x[1]
df['C'] = df[['A','B']].apply(func,axis=0)
df
если заменить
df['C'] = df[['A','B']].apply(func,axis=0)
df
на
a,b = df[['A','B']].apply(func,axis=0)
a,b
то как раз и увидим, что результат выполнения apply - два числа.
В случае, если axis=1, функция apply берет первую строку, из неё значения из столбцов A и B, и передает их в func. Затем вторую строку, затем третью и т.д. Каждый раз возвращается одно число, которое записывается в соответствующую строку столбца С. Таким образом, столбец С заполняется полученными значениями
import pandas as pd
import numpy as np
df = pd.DataFrame(np.random.randn(6, 2), columns=list("AB"))
print(df,'\n')
def func(x):
    print('значения, переданные из apply:','\n',x, type(x),'\n')
    if x[1]>x[0]:
        print('возвращаемое значение:', -x[1],'\n')
        return -x[1]
    else:
        print('возвращаемое значение:', -x[1],'\n')
        return x[1]
df['C'] = df[['A','B']].apply(func,axis=1)
df 
(edited)

TatianaK  6 hours ago
@Sergey Meshcheryakov спасибо огромное!! Вот это обьяснение, что даже я поняла))



EDA 
Про заполнение пропусков:
http://www.machinelearning.ru/wiki/images/9/90/Kayumov_course_work_imputer_methods.pdf
https://ru.coursera.org/lecture/unsupervised-learning/obrabotka-propuskov-3mRlZ

Про типы переменных в Data Science:
https://towardsdatascience.com/variable-types-and-examples-cf436acaf769

Шпаргалка Markdown:
http://ilfire.ru/kompyutery/shpargalka-po-sintaksisu-markdown-markdaun-so-vsemi-samymi-populyarnymi-tegami/

Анкета обратной связи по вебинару:
https://docs.google.com/forms/d/e/1FAIpQLScV-_4J0RMEpnTw1PEabGZIfnT5pD0JtzMdPJ2NXgnd2CRihw/viewform

Шпаргалка Markdown:
http://ilfire.ru/kompyutery/shpargalka-po-sintaksisu-markdown-markdaun-so-vsemi-samymi-populyarnymi-tegami/

Про EDA (на R, но нам важна суть):
https://habr.com/ru/post/480532/
https://habr.com/ru/company/mlclass/blog/270973/

Интересный пакет для EDA в Python:
https://habr.com/ru/company/ruvds/blog/451478/

Анкета обратной связи по вебинару:
https://docs.google.com/forms/d/e/1FAIpQLScV-_4J0RMEpnTw1PEabGZIfnT5pD0JtzMdPJ2NXgnd2CRihw/viewform



user_id & time

Marina Bovkush Feb 3rd at 4:18 PM
Добрый день! Подскажите с заданием 12.1.4, пожалуйста. Здесь же подразумевается использование параметра subset? Если да, то я не могу никак додумать, как удалить весь столбец, потому что если я правильно понимаю, мой код удалит строки, для которых в соответствующих столбцах есть пропуски. И примеры не получается найти, застряла.
log3 = log.dropna(subset=['user_id', 'time'])
:white_check_mark:
1

10 replies

Sergey Meshcheryakov  2 months ago
Добрый день. Попробуйте добавить параметр axis=1

Marina Bovkush  2 months ago
@Sergey Meshcheryakov Делала, выдает ошибку
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-53-6763f3ab3d04> in <module>
----> 1 log3 = log.dropna(axis = 1, subset=['user_id', 'time'])
      2 display(log3)
~/opt/anaconda3/lib/python3.8/site-packages/pandas/core/frame.py in dropna(self, axis, how, thresh, subset, inplace)
   4746             check = indices == -1
   4747             if check.any():
-> 4748                 raise KeyError(list(np.compress(check, subset)))
   4749             agg_obj = self.take(indices, axis=agg_axis)
   4750 
KeyError: ['user_id', 'time']
Но это и не подходит, судя по тексту:
Еще один интересный параметр - subset. Что он делает? Если передать в него список значений по одной оси (например, названия столбцов) и задать при этом в параметре axis другую ось (в нашем случае 0), то мы удалим те строки, для которых в данных столбцах находится пропуск. То же самое работает и наоборот: нужно поменять axis на 1 и вместо названий столбцов передавать индексы строк.

Sergey Meshcheryakov  2 months ago
Да, Вы правы, забыл, что там разные оси должны быть.

Sergey Meshcheryakov  2 months ago
Я так удалял.
import pandas as pd
log = pd.read_csv('log.csv',header=None)
log.columns = ['user_id','time','bet','win']
for column in log.columns[0:2]:
    if log[column].hasnans:
        log.drop(column, axis=1, inplace=True)
log
:+1:
1


Marina Bovkush  2 months ago
@Sergey Meshcheryakov Спасибо! Хотелось бы, конечно, увидеть ответ ментора, потому как вы используете hasnans, который не рассматривается в разделе, а материала текста вроде бы как должно быть достаточно для решения:thinking_face:

Sergey Meshcheryakov  2 months ago
Похоже, что с помощью dropna нельзя удалить конкретный столбец. @Владимир Горюнов так ли это?
https://skillfactorydst.slack.com/archives/C017W3DUNHM/p1606222400100400
https://skillfactorydst.slack.com/archives/C017W3DUNHM/p1608775381183900
Если не нравится hasnans :slightly_smiling_face: можно так
import pandas as pd
log = pd.read_csv('log.csv',header=None)
log.columns = ['user_id','time','bet','win']
for column in log.columns[0:2]:
    if log[column].isna().sum()>0:
        log.drop(column, axis=1, inplace=True)
log
Королева Наталия
Добрый день. Посмотрите где у меня ошибка в задание 12.1.4 У меня после выполнения остается 4 столбца, а должно 3                                                                            log.dropna(subset=['user_id', 'time'])
Thread in #01-python-12 | Nov 24th, 2020 | View message
Anton Nepotenko
12.1.4. Подскажите пожалуйста, как удалить конкретный столбец, если в нем есть пропуски?
Я написал так:
import pandas as pd
log = pd.read_csv("/Users/Tony/Anton test/log.csv")
log.columns = ['user_id','time', 'bet','win']
Show more
Thread in #01-python-12 | Dec 24th, 2020 | View message

Дмитрий Савенков  2 months ago
Присоединюсь к вопросы, так же интересно узнать, как можно решить задание с помощью subset

Marina Bovkush  2 months ago
@Support кто из менторов может посмотреть ветку и ответить?

Support  2 months ago
Здравствуйте, дорогие студенты!
@Владимир Горюнов @Мария Жарова нужна ваша помощь!:pray::skin-tone-2:

Владимир Горюнов  2 months ago
Добрый вечер.
Действительно, Сергей предложил лучшие варианты решения в данном случае.
Ошибку c axis = 1 можно решить заменив на axis = 'columns'
в subset в таком случае можно будет передать индексы строк в которых user_id и time равны NaN
log.dropna(axis='columns', subset=log.loc[log.time.isna() | log.user_id.isna()].index)
но это также приведет к удалению столбцов bet и win у которых в данных строках также имеются пропущенные значения, если бы их было заведомо меньше чем в time, можно было бы применить параметр thresh, но в данном случае это не сработает.
2021-02-09_22-41-28.png 






Задание 12. Добрая ночь. Подскажите пожалуйста, почему система может не принимать ответ. В юпитере нормально работает
import pandas as pd
log = pd.read_csv('log.csv')
log.columns = ['user_id', 'time', 'bet', 'win']
#удалим строки, которые содержат значения user_id с ошибками;
log1=log
log = log1[~log1.user_id.str.match('#error')]
#оставим в поле user_id значение типа: "user_N", где N значение идентификатора;
log1=log
log.user_id = log1.user_id.apply(lambda s: s[s.find('user_'):])
#уберём начальную скобку из поля time.
log1=log
log.time = log1.time.apply(lambda s: s.replace('[',''))

Vadim Feb 5th at 11:38 AM
День добрый.
Катерина, задание 9 и 12.
На одно и тоже требование «Уберите ненужную скобку "[" из поля в time. Результат сохраните в log:» в задание 8 и «уберём начальную скобку из поля time.» в задании 12
применяю одно и тоже решение (log.time = log.time.apply(lambda y: str(y)[1:])). Проверка задания 12 принимает и ставит Correct, но проверка задания 8 не проходит.

Grigory Tekuchev Feb 6th at 6:44 PM
Добрый день!
Задание 11.9. Уберите ненужную скобку "[" из поля в time. Результат сохраните в log:
Подскажите, пожалуйста, почему не подходит вариант:
log = pd.read_csv('log.csv', header=None)
log.columns = ['user_id','time','bet','win']
# Напишите ваш код ниже
log.time = log.time.apply(lambda x: str(x).replace('[',''))
В Юпитере результат визуально похож на целевой.
210206 png1.png 
210206 png1.png


:white_check_mark:
1





2 replies

Мария Жарова  2 months ago
Добрый день!
Попробуйте такую конструкцию (сразу всё преобразовываем к str и применяем replace): log.time = log.time.str.replace('[', '')
:heart:
1


Grigory Tekuchev  2 months ago
Добрый день!
Мария, спасибо, в таком виде решение принимается.


Ольга Евсикова Feb 19th at 4:21 PM
Здравствуйте!
Помогите, пожалуйста, разобраться с заданием 8.11.2
«С помощью apply и lambda-функции замените все буквы в поле City на маленькие и сохраните в sample2. Вам может понадобиться функция s.lower().»
Обратите внимание: когда в столбце есть пропущенные значения, необходимо в явном виде указывать, что это str.  str(s).lower()
Я сделала так, но не могу додуматься, как сделать через apply и lambda-функции:
import pandas as pd
sample = pd.read_csv("sample.csv")
sample2 = sample.columns.values
for i in range(len(sample2)):
   sample2[i] = str(sample2[i]).lower()
sample2




9 replies

Владимир Горюнов  1 month ago
Добрый день!
Вот так например (определив функцию которая будет применена к каждому значению из поля City)
import pandas as pd
sample = pd.read_csv("sample.csv")
def func(x):
    return str(x).lower()
sample2=sample
sample2['City'] = sample.City.apply(func)
print(sample2)
Или с помощью лямбда-функции вот так
sample2['City'] = sample.City.apply(lambda x: str(x).lower())
:+1:
1


Ольга Евсикова  1 month ago
Владимир, спасибо большое!

Ольга Евсикова  1 month ago
Я извиняюсь, ломала голову над двумя задачами, в итоге вставила код из другого задания 8.5.2. С 11.2 теперь стало понятно)
Но появился другой вопрос. Задание 8.5.2
‘Создайте в sample заголовки колонок так, чтобы там были только маленькие буквы.
Например, вместо 'Age' нужно сделать 'age’: ’
import pandas as pd
sample = pd.read_csv("sample.csv")columns = sample.columns.values
for i in range(len(columns)):
   columns[i] = str(columns[i]).lower()
columns
По условию задачи этого нет, но можно ли этот код задать с помощью lambda-функции?

Sergey Meshcheryakov  1 month ago
@Ольга Евсикова добрый день. Ваш код можно записать так:
import pandas as pd
sample = pd.read_csv('sample.csv')
sample.columns = [str(x).lower() for x in sample.columns.values]
sample.head()
если хотите через лямбду, можно так:
import pandas as pd
sample = pd.read_csv('sample.csv')
sample.columns = list(map(lambda x: str(x).lower(), sample.columns.values))
sample.head()
или так
import pandas as pd
sample = pd.read_csv('sample.csv')
sample.columns = pd.Series(sample.columns).apply(lambda x: str(x).lower())
sample.head()
:+1:
1


Ольга Евсикова  1 month ago
Сергей, спасибо большое за ответ!:slightly_smiling_face:
:+1:
1


AYA_Andrey  1 month ago
Добрый день.
8.5.2  Такой вариант решения допускается? Грейдер его не принимает.
import pandas as pd
sample = pd.read_csv('sample.csv')
sample.columns = [columns.str.lower()]
sample.head()

Sergey Meshcheryakov  1 month ago
Добрый день
sample.columns = [sample.columns.str.lower()]

AYA_Andrey  1 month ago
Сергей, спасибо, я понял, что так более корректно (хотя результат не меняется, в двух вариантах заголовки корректно поменялись на маленькие буквы). Но Грейдер все равно не принимает(((

Sergey Meshcheryakov  1 month ago
Вот так принимает
sample.columns = list(sample.columns.str.lower())
[sample.columns.str.lower()] возвращает данные типа мультииндекс, видимо это не нравится

AlanYussJr Feb 22nd at 5:21 PM
@Екатерина Попова @Мария Жарова @Sergey Meshcheryakov, 8.12.1 ответ не принимается, хотя в Jypyter - всё работает.
import pandas as pd
log = pd.read_csv('log.csv',header=None)#прочитаем файл в переменную log;
log.columns = ['user_id', 'time', 'bet', 'win'] #добавим названия колонок user_id, time, bet, win;
def id_user_clean(user_id):
    if user_id == '#error':
        return '' #удалим строки, которые содержат значения user_id с ошибками;
    else:  #оставим в поле user_id значение типа: "user_N", где N значение идентификатора
        return user_id.replace('Запись пользователя № - ','') 
log['user_id'] = log.user_id.apply(id_user_clean)
log.time = log.time.str.replace('[', '') #уберём начальную скобку из поля time.
log (edited) 




4 replies

Sergey Meshcheryakov  1 month ago
Проблема здесь
return '' #удалим строки, которые содержат значения user_id с ошибками;
Вы не удаляете строки, а просто заменяете #error на пустые значения

Sergey Meshcheryakov  1 month ago
строки можно удалить так
log = log.drop(log[log.user_id.str.contains('error', na=False)].index)
:+1:
1


Марина Архипцева (эксперт)  1 month ago
@Sergey Meshcheryakov спасибо за ответ!


11.9 в чем я ошибся не могу понять в ноутбуке все ок, код выполняется и делает все по заданию:
2 files 
image.png


image.png


:white_check_mark:
1





3 replies

Sergey Meshcheryakov  1 month ago
Вы все значений в столбце time привели к типу str, а изначально в столбце есть пропуски - NaN, которые относятся к типу float и которые не нужно трогать. Это можно сделать так
log = pd.read_csv('log.csv', header=None)
log.columns = ['user_id','time','bet','win']
# Напишите ваш код ниже
log.time = log.time.apply(lambda t: t if pd.isna(t) else str(t).replace('[',''))
image.png 
image.png


:+1:
2


Марина Архипцева (эксперт)  1 month ago
Или так log.time = log.time.apply(lambda x : x[1:] if pd.notna(x) else x)
:+1:
2


Марина Архипцева (эксперт)  1 month ago
В любом случае подход одинаковый - NaN пропускаем



AYA_Andrey Mar 3rd at 12:41 PM
Добрый день.
8.11.7 Подскажите в чем ошибка, юпитер выдает корректный вариант, но грейдер не принимает.
log = pd.read_csv('log.csv', header=None)
log.columns = ['user_id','time','bet','win']
# Напишите ваш код ниже
def user(x):
    if len(x) > 6:
        x = x[-8:]
        return x
    else:
        return ""
log['user_id'] = log.user_id.apply(user)
log
:white_check_mark:
1

1 reply

Sergey Meshcheryakov  25 days ago
Добрый день. Потому что в log.user_id есть такое значение:
Запись пользователя № - user_1000
Ваш срез x[-8:] обрезает его до
ser_1000
(edited)


Андрей Соколов Mar 8th at 7:05 PM
не принимает 8.12
log = pd.read_csv("log.txt",header=None) 
log.columns = ['user_id','time','bet','win']
log = log[~log['user_id'].str.contains('#')]
log['user_id'] = log['user_id'].apply(lambda x: x[-8:])
log['time'] = log['time'].apply(lambda x: x[1:] if pd.notna(x) else x)
:white_check_mark:
1





3 replies

Sergey Meshcheryakov  20 days ago
Добрый день. Срез неправильный + log.txt нужно заменить на log.csv
https://skillfactorydst.slack.com/archives/C018H18KJ4U/p1614764464056400 (edited) 
AYA_Andrey
Добрый день.
8.11.7 Подскажите в чем ошибка, юпитер выдает корректный вариант, но грейдер не принимает.
log = pd.read_csv('log.csv', header=None)
log.columns = ['user_id','time','bet','win']
# Напишите ваш код ниже
Show more
Thread in #01-python-08 | Mar 3rd | View message
:+1:
1


Андрей Соколов  20 days ago
про txt поправил, про срез, увы, не понял.

Sergey Meshcheryakov  20 days ago
Выполните после Вашего кода
log[log.user_id.str.contains('1000')|log.user_id.str.contains('999')]
(edited)


Шуваева Валерия Mar 16th at 11:08 PM
Здравствуйте! Задание 11.7 не принимает, хотя в Юпитере срабатывает.
log = pd.read_csv('log.csv', header=None)
log.columns = ['user_id','time','bet','win']
def user_id(x):
    if '#error' in x:
        return ''
    else: 
        return x[-9:]
log['user_id'] = log.user_id.apply(user_id)




3 replies

Sergey Meshcheryakov  12 days ago
Добрый вечер. Ошибка в срезе x[-9:]
https://skillfactorydst.slack.com/archives/C018H18KJ4U/p1615219510072200
Андрей Соколов
не принимает 8.12
log = pd.read_csv("log.txt",header=None) 
log.columns = ['user_id','time','bet','win']
log = log[~log['user_id'].str.contains('#')]
log['user_id'] = log['user_id'].apply(lambda x: x[-8:])
Show more
Thread in #01-python-08 | Mar 8th | View message

Sergey Meshcheryakov  12 days ago
Лишний пробел
image.png 
image.png

Rustam Mar 20th at 2:49 PM
добрый день. 11.8-11.9  В чем проблема кода?
log = pd.read_csv("log.xls",header=None)
log.columns = ['user_id','time','bet','win']
t = log.time[0]
def times(x):
    if "[" in x:
        return x[1:]
log['time']=log.time.apply(times) (edited) 
:white_check_mark:
1





2 replies

Мария Жарова  8 days ago
Добрый день!
Здесь не нужно оформлять отдельную функцию, попробуйте воспользоваться методом replace:
log.time = log.time.str.replace('[', '')

Sergey Meshcheryakov  8 days ago
Добрый день. Добавлю, что оператор in применим только к итерируемым объектам(последовательностям). В столбце time присутствуют пропуски - NaN, которые относятся к типу данных float и не являются итерируемыми объектами. Поэтому,  if "[" in x: даст ошибку. Чтобы этого избежать, на время осуществления сравнения, х можно привести к типу данных str - if "[" in str(x):
Также, у Вас не предусмотрено, что возвращает функция, если условие не выполнится. Из-за этого, функция будет в этом случае возвращать None. Т.е. в Вашем варианте, для 11.9 нужно скорректировать так
def times(x):
    if "[" in str(x):
        return x[1:]
    else:
        return x
log = pd.read_csv("log.csv",header=None)
log.columns = ['user_id','time','bet','win']
log['time']=log.time.apply(times)
log['time']
:+1:
1



Марина Архипцева (эксперт)  12 days ago
Добрый день! Надо срез делать не просто от номера (все строки разные и трудно угадать), а найти позицию подстроки 'user_' в строке и оставлять начиная с неё.



Александр Тархов Mar 25th at 11:21 AM
Доброе утро!
В 12.1 мой код выдаёт ошибку, хотя в Visual Studio всё получается. Не могу понять какую деталь я упустил
log = pd.read_csv('log.csv')
log.columns = ['user_id', 'time', 'bet', 'win']
def logCorrect(a):
    s = str(a)
    newLog = ''
    if 'error' not in s:
        newLog = s.replace('Запись пользователя № - ', '')
    return newLog
def timeReplace(t):
    result = t
    if type(t) != float:
        result = t.replace('[', '')
    return result
log.user_id = log.user_id.apply( logCorrect )
log.time = log.time.apply( timeReplace )
log = log[log.user_id != ''] 
 (edited) 




4 replies

Марина Архипцева (эксперт)  3 days ago
Добрый день! Напишите, пожалуйста, какое задание из 12.1 вы делаете. :pray:

Александр Тархов  3 days ago
Python-8 > 12 > 1 (финальное задание). Оно там единственное, если я ничего не путаю (edited) 

Sergey Meshcheryakov  3 days ago
Добрый день. Забыли про параметр header
log = pd.read_csv('log.csv', header=None)
:+1:
2


Александр Тархов  3 days ago
Точно! Спасибо большое :)


Inga Feb 1st at 2:00 PM
Подскажите пожалуйста, что-то запуталась в условии. Задание 9.1. Посчитайте медиану баланса по каждому пользователю. Для этого сгруппируйте по пользователям, возьмите признак net, просуммируйте по каждому пользователю и получите медиану.
import pandas as pd
users = pd.read_csv('users.csv', encoding='koi8_r', sep ='\t')
log = pd.read_csv('log.csv', header=None)
users.columns=['user_id','email','geo']
log.columns=['user_id', 'time', 'bet', 'win']
log.time = log.time.str.replace('[', '')  
users.user_id = users.user_id.apply(lambda x: x.lower())   
log = log[log.user_id != '#error']  
log.user_id = log.user_id.str.split(' - ').apply(lambda x: x[1]) 
df=(pd.merge(log, users, on='user_id').fillna(0))
df[df.email.str.contains('net', na=False)]).groupby('user_id').sum().median()
(edited)
:white_check_mark:
1





5 replies

Sergey Meshcheryakov  2 months ago
Добрый день.
Для этого сгруппируйте по пользователям df.groupby('user_id'), возьмите признак net, просуммируйте по каждому пользователю sum() и получите медиану .median()
int(df.groupby('user_id').net.sum().median())

Inga  2 months ago
Пишет ошибку.  Признак net - это из колонки email? или это что-то другое?

Inga  2 months ago
Снимок экрана 2021-02-01 165141.png 
Снимок экрана 2021-02-01 165141.png



Владимир Горюнов  2 months ago
Признак net это из задания 12.7.1.
При модификации датасета log.csv, пропущенные значения в столбцах bet и win замените на  0, cоздайте столбец net, хранящий сумму выигрыша с учетом ставки (для этого из столбца win поэлементно вычтите столбец bet и запишите в новый столбец).

Inga  2 months ago
Теперь понятно в задании просто написано,  использовать датасет, который получился в результате преобразований, выполненных в задании 12.8.1, поэтому не подумала


Добрый вечер! Задание 12.7.5 ответ получается 100%
import pandas as pd
import numpy as np
from datetime import datetime
log = pd.read_csv("log.csv", header = None)
log.columns = ['user_id', 'time', 'bet', 'win']
log.bet=log['bet'].fillna(0)
log.win=log['win'].fillna(0)
log['net'] = log['win'] - log['bet']
a = (log.net>0).count() # количество выигрышей
b = (log.net!=0).count() # количество ставок
win_bet = (a/b)*100
win_bet
2 replies

Sergey Meshcheryakov  2 months ago
Добрый день. Вместо count попробуйте sum.
log.net>0 и log.net!=0 это серии из булевых значений. count считает длину этих серий. И там и там это 1000.
:+1:
2

Petrovich Feb 17th at 10:06 PM
def per(h):
    if 0<=h<=5:return 'ночь'
    elif 6<=h<=11:return 'утро'
    elif 12<=h<=17:return 'день'
    elif 18<=h<=23:return 'вечер'
log = pd.read_csv('log.csv',header = None)
log.columns = ['user_id','time','bet','win']
log = log.dropna(axis = 0,subset = ['time'])
log.time = log.time.apply(lambda x:str(x).replace('[',''))
log['time'] = pd.to_datetime(log['time'])
log['time'] = log.time.dt.hour
log.time.apply(per).value_counts()
:heavy_check_mark:
1

2 replies

Sergey Meshcheryakov  2 months ago
Добрый вечер.
Посчитайте, какое время дня встречается в данных реже всего.
"вечер" - правильный ответ. Нет ошибки

Petrovich Feb 25th at 6:01 PM
Нужен совет по заданию 12,10,3
Валидатор не принимает код, где ошибся не понимаю
import pandas as pd
import numpy as np
log = pd.read_csv('log.csv',header = None)
log.columns = ['user_id','time','bet','win']
users = pd.read_csv('users.csv', encoding='KOI8-R', sep='\t')
users.columns = ['user_id','email','geo']
users.user_id = users.user_id.apply(lambda x: x.lower())
log = log[log.user_id != '#error']
log.user_id = log.user_id.str.split(' - ').apply(lambda x: x[1])
df = pd.merge(log, users, on='user_id')
sample2 = df.groupby('geo').user_id.count()
3 replies

Sergey Meshcheryakov  1 month ago
Добрый день. У Вас все правильно
@Support эта ошибка
Code error: ValueError('Length mismatch: Expected axis has 5 elements, new values have 4 elements',)
появляется везде, не только здесь https://skillfactorydst.slack.com/archives/C018H18KJ4U/p1614264202024000?thread_ts=1610996015.011800&cid=C018H18KJ4U
Дмитрий Кузнецов
@Support Есть основание полагать, что 8.8.2 не работает по причине тех. работ. Выдается та же ошибка, что и при отправке ответа на 8.5.3: "Code error: ValueError('Length mismatch: Expected axis has 5 elements, new values have 4 elements',)".
Что скажете?
From a thread in #01-python-08 | Feb 25th | View reply

Support  1 month ago
Здравствуйте!
Примите наши извинения за неудобства!
Передали редакторам курса! Исправят в ближайшее время. (edited) 

Petrovich  1 month ago
Да. Именно эта ошибка..


Marija Kudinova  12:17 AM
помогите с 12.6.2.
:white_check_mark:
1

12:19
def new_1(win, bet):
    if win < 0:
        return win
    else:
        return win - bet
log['net'] = log.apply(lambda x: new_1(x['win'], x['bet']), axis=1)
(log['net']>0).sum()
:white_check_mark:
1

12:19
(log['net']>0).mean()
:white_check_mark:
1

12:20
не то выдает в ответе
:white_check_mark:
1


Sergey Meshcheryakov  12:28 AM
Добрый вечер. Попробуйте
log['net'][log['net']>0].mean()
:+1:
2
:white_check_mark:
1


Marija Kudinova  2:12 PM
16.7.1 что не так?

Marija Kudinova Mar 2nd at 2:12 PM
log.bet = log.bet.fillna(0)
log.win = log.win.fillna(0)
log['net'] = log['win']-log['bet']
:white_check_mark:
1





7 replies

Sergey Meshcheryakov  1 month ago
Добрый день.
log.bet.sum() - это сумма ставок, а не их количество. Воспользуйтесь count()

Marija Kudinova  1 month ago
round(((log.bet>0).sum()/(log.bet).count())*100, 1)

Marija Kudinova  1 month ago
почему сдесь тогда сумм в начале?

Sergey Meshcheryakov  1 month ago
log.bet>0 это серия из булевых значений. Где True - это ставка больше 0, False - иное значение ставки.
sum() суммирует True (True принимается равным 1), т.е. фактически получаем количество ставок, удовлетворяющих условию.
:pray:
1
:+1:
1


Marija Kudinova  1 month ago
вообще путаюсь когда квадратные скобки когда круглые

Марина Архипцева (эксперт)  1 month ago
Добрый день! @Sergey Meshcheryakovбольшое спасибо за ответы!

Марина Архипцева (эксперт)  1 month ago
@Marija Kudinova круглые для вызовов функций и методов, а квадратные для обращений к элементам списков, датафреймов.


Marija Kudinova  2:13 PM
round((log.bet>0).sum()/(log.bet).sum()*100, 1)
:white_check_mark:
1


Marija Kudinova  2:25 PM
и здесь не1 выдает ответ
:white_check_mark:
1


Marija Kudinova  2:25 PM
x = (log.bet>0).mean()

1 reply

Sergey Meshcheryakov  1 month ago
(log.bet>0).mean()*100
:+1:
1


Арсений Самойлов Mar 9th at 12:19 PM
Добрый день, задание 12.7.6
import pandas as pd
log = pd.read_csv('log.csv', header = None)
log.columns = ['user_id', 'time', 'bet', 'win']
log = log.dropna()
min_bet_amount = log['bet'][log['bet'] == log['bet'].min()].count()
не принимает ответ, помогите разобраться пожалуйста.
:white_check_mark:
1

2 replies

Марина Архипцева (эксперт)  28 days ago
Добрый день!
log = log.dropna() здесь лишнее удаляется. Эта строка лишняя. Пустые значения не помешают подсчету минимального.

Арсений Самойлов  28 days ago
ок,спасибо


Dmitriy Mar 13th at 1:19 PM
Добрый день, задание 12.2.5
users = pd.read_csv("users.csv", sep='\t', encoding='KOI8-R' )
users.columns = ['user_id', 'email', 'geo']
log = pd.read_csv("log.csv",header=None)
log.columns = ['user_id','time', 'bet','win']
log.time = log.time.str.replace('[','')
log = log.dropna(subset=['time'])
log.drop_duplicates(subset=['user_id','time'])
log.time = pd.to_datetime(log['time'])
log['hour'] = log['time'].apply(lambda x: x.hour)
log
ошибка, хотя столбец hour присутствует.




2 replies

Sergey Meshcheryakov  24 days ago
Добрый день.
Необходимо избавиться от всех пропусков, а не только в столбце time. Удаление дубликатов заданием не предусмотрено. Users тут совсем не нужен.
Извлечь признак из time можно с помощью аксессора log['hour'] = log.time.dt.hour (edited) 
:+1:
2


Dmitriy  24 days ago
Точно, в задании написано избавиться в log а не time. Это было 12.4.5 , которое под * (не 12.2.5)


Василий Кашеваров Mar 22nd at 6:26 PM
Добрый день! Задание 12.4.5.
Подскажите пожалуйста, почему система не принимает решение:
import pandas as pd
log = pd.read_csv("log.csv")
log.columns = ['user_id', 'time', 'bet', 'win']
log.dropna(inplace=True)
log.time = log.time.apply(lambda x: str(x.replace('[', '')))
log.time = pd.to_datetime(log['time'])
log['hour'] = log.time.dt.hour (edited) 




2 replies

Владимир Горюнов  15 days ago
Добрый вечер!
У вас все правильно, нужно только добавить header=None при чтении файла
log = pd.read_csv("log.csv", header=None)

Василий Кашеваров Mar 24th at 4:00 PM
Добрый день! Посоветуйте пожалуйста, как лучше решать Задание 12.5.2. Пробовал осуществлять проверку с помощью isna и isnull, но они в данной ситуации не работают, так как менять на ноль нужно значения типа float, а эти методы только к сериям применимы. Тогда нужно ставить условия вручную: row.win=='nan' or row.win==None? Или предполагается способ, при котором можно использовать данные методы?
Код:
def  fillna_win(row):
    if row.win.isna()==False:
        return row
    elif row.win.isna()==True and row.bet.isna()==True:
        row.win.fillna(0)
        return row
    elif row.win.isna()==True and row.bet.isna()==False:
        row.win = -(row.bet)
        return row
new_log = log.apply(lambda row: fillna_win(row), axis=1)
Ссылка https://lms.skillfactory.ru/courses/course-v1:Skillfactory+DST-WEEKLY-2.0+08JULY2020/c[…]Btype%40vertical%2Bblock%40558e9ed565a74b39930e9fc95c5ddd6b
12.5.2.PNG 
12.5.2.PNG


3 replies

Марина Архипцева (эксперт)  13 days ago
Добрый день! Предлагаю такой алгоритм: функция возвращает 1 при отрицательном значении win и 0 в обратном случае. Затем через sum считаем сумму в столбце, так мы получим количество отрицательных выигрышей.

Sergey Meshcheryakov  13 days ago
Добрый день. Добавлю, что isna() можно применять не только к сериям, но и в виде pd.isna() к отдельным значениям. Вот как это выглядит
import pandas as pd
import numpy as np
x = [np.nan,10,20,np.nan,30,40]
for i,value in enumerate(x):
    if pd.isna(value):
        print('{}й элемент - NaN'.format(i))
:+1:
2


Василий Кашеваров  13 days ago
Спасибо!


Василий Кашеваров Mar 25th at 6:49 PM
Добрый вечер! Задание 12.10.3
Почему система может не принимать?
# ваш код здесь
import pandas as pd
log = pd.read_csv("log.csv", header=None)
log.columns = ['user_id', 'time', 'bet', 'win']
log = log[log.user_id!= '#error']
log.user_id = log.user_id.str.split(' - ').apply(lambda x: x[1])
users = pd.read_csv('users.csv', sep ='\t', encoding='koi8_r')
users.columns=['user_id', 'email', 'geo']
data = pd.merge(log, users, on='user_id')
sample2 = data.groupby('geo').user_id.count() # еще код




2 replies

Владимир Горюнов  12 days ago
Добрый вечер!
Не привели к единому виду поле user_id. В файле users пользователи с большой буквы User_943
У вас в итоге пустой датасет data получался.
users.user_id = users.user_id.apply(lambda x: x.lower())

Василий Кашеваров  12 days ago
Понятно,  спасибо!

Василий Кашеваров Mar 25th at 9:03 PM
Ещё раз добрый вечер! Подскажите пожалуйста, какой способ лучше использовать, чтобы исключить тех пользователей ,  у которых значения равны только 0 в задании 12.9.2. Не удалял их и ответ получился правильный, поскольку количество тех, кто делал и не делал ставки, совпадает. Но хотелось бы знать, как это делается.
Кроме того, в 12.9.3 тоже требуется исключить группы, у которых нет ставок больше 0.
В 12.9.3 предполагается использование Counter? (edited) 
4 replies

Владимир Горюнов  12 days ago
Нет, Counter использовать не нужно, достаточно pandas методов подсчета значений.
Пример из 12.9.2 - идея в том чтобы сначала отобрать пользователей удовлетворяющих условиям по ставкам, а затем группировать их.
# после преобразований объединили данные из двух файлов
users_log = pd.merge(log, users, on ='user_id')
# создаем два датафрейма для подсчета случаев нулевой ставки
group = users_log[users_log.bet==0].groupby('user_id').bet.count() 
group_not_null = users_log[users_log.bet>0].groupby('user_id').bet.count()
# и объединяем по user_id
joined=pd.merge(group, group_not_null, on=['user_id'])
# Оставим только те строки, в которых у посетителя была хотя бы одна ставка
joined = joined[joined['bet_y']>0]
# И посчитаем среднее количество приходов без ставки
joined['bet_x'].sum()/len(joined)
:+1:
1


Василий Кашеваров  12 days ago
При объединении возникает ошибка
joined=pd.merge(group, group_not_null, on=['user_id'])
ошибка при объединении.PNG 
ошибка при объединении.PNG



Василий Кашеваров  12 days ago
А нет, это было из-за того, что я cчитал по полю user_id вместо bet (edited) 

Василий Кашеваров  12 days ago
Хороший способ, спасибо!

Julija Balanova Mar 26th at 5:33 PM
Подскажите пожалуйста, в 12.6.3. => Задание 3
Посчитайте средний выигрыш (из столбца net) в тех случаях, когда ставка была сделана. В ответ запишите полученное число с отброшенной дробной частью.
Пояснение: выигрыш в данном случае означает изменение количества денег и может быть отрицательным. В таком случае это проигрыш.
Считать только выигрыш, т.е. только положительное изменение? (edited) 
3 replies

Марина Архипцева (эксперт)  11 days ago
Добрый день! Всё верно.

Julija Balanova  10 days ago
@Марина Архипцева (эксперт)
помогите пожалуйста, видимо я запуталась со значениями
к этой задаче
log = pd.read_csv('/Users/jbalanova/downloads/log.csv', header=None)
log.columns = ['user_id','time','bet','win']
def new_1(win, bet):
    if win < 0:
        return win
    else:
        return win - bet
log['net'] = log.apply(lambda x: new_1(x['win'], x['bet']), axis=1)
log['net'][log['net']>0].mean()
ответ не верный ...

Марина Архипцева (эксперт)  8 days ago
Пропущено условие "пропущенные значения в столбцах bet и win замените на 0"
"Посчитайте средний выигрыш (из столбца net) в тех случаях, когда ставка была сделана" - признак того, что ставка сделана log['bet']>0


Задание 12.5.2
Подскажите, почему получается сумма = 0?
Делаю, так:
log = pd.read_csv("log.csv", header=None)
log.columns = ['user_id', 'time', 'bet', 'win']
log['win'] = log.win.fillna(0)
log['new_win'] = log.win.apply(fillna_win)
т.е. добавляю новый столбец где функция ставил 0 или 1
def  fillna_win(row):
    if row < 0:
        return 1
    elif row >= 0:
        return 0


Stepan Mar 28th at 2:32 PM
забыл еще row = log.win
:white_check_mark:
1

2 replies

Мария Жарова  9 days ago
Добрый день!
Функцию нужно сделать так, чтобы она заполняла значения в датасете. Также попробуйте добавить заполнение пропущенных значений в столбце bet
log['bet']=log['bet'].fillna(0)
log['win']=log['win'].fillna(0)
def fillna_win(row):
   if row.win<=0:
       if row.bet == 0:
           row.win = 0
       else:
           row.win = -row.bet
   return row.win
new_win=log.apply(lambda row: fillna_win(row), axis=1) (edited) 

Stepan  9 days ago
ок, получилось. спасибо



Stepan Mar 28th at 11:34 PM
Задание 12.9.2
Для того, чтобы узнать это, просуммируйте в каждой группе количество записей со ставкой, равной 0, и поделите на общее количество групп. Если при этом в группе нет записей со ставкой больше 0, считаем количество записей в данной группе равным 0.
Что имеется ввиду под группами?
1 reply

Марина Архипцева (эксперт)  9 days ago
Добрый день! Главная идея задания - отбираем пользователей удовлетворяющих условиям по ставкам, а затем группируем.
1 Получаем датафрейм, объединяющий user  и log
2 Находим количество нулевых ставок - отбираем данные по условию users_log.bet==0, группируем по пользователю, считаем количество
3 Аналогично предыдущему, только для ставок больше нуля.
4 Объединяем датафреймы из шагов 2 и 3
5 Оставляем только те строки, в которых у посетителя была хотя бы одна ставка
6 Считаем среднее количество приходов без ставки


Stepan Mar 29th at 8:21 AM
Задание 12.9.1 не могу понять, почему не принимается результат?
log_users.groupby('user_id').net.sum().median()
получаю 5739
что то где то теряется...
7 replies

Марина Архипцева (эксперт)  9 days ago
Добрый день! Надо смотреть весь предыдущий код. Я применила точно такую же формулу к своему датасету и получила верный результат. Видимо дело в преобразованиях выше.

Stepan  9 days ago
def net1(row):
    if row.win < 0:
        return row.win
    else:
        return row.win - row.bet
new_net = log.apply(lambda row: net1(row), axis=1)
log['net'] = new_net

Stepan  9 days ago
log = pd.read_csv("log.csv", header=None)
log.columns = ['user_id', 'time', 'bet', 'win']
users = pd.read_csv("users.csv", sep = '\t', encoding='KOI8-R')
users.columns = ['user_id', 'email', 'geo']
# Приведем признак user_id к одному формату в обоих датасетах
users.user_id = users.user_id.apply(lambda x: x.lower())
# Избавимся от ошибок в user_id
log = log[log.user_id != '#error']
log.user_id = log.user_id.str.split(' - ').apply(lambda x: x[1])

Stepan  9 days ago
log_users - это объединенный    df. но он тут и не нужен..

Марина Архипцева (эксперт)  9 days ago
Надо заполнить пустые значения log.fillna(0, inplace = True)
"log_users - это объединенный   df. но он тут и не нужен.." считать надо именно по объединенному.

Марина Архипцева (эксперт)  9 days ago
Так надо по условию задания "Используйте датасет, который получился в результате преобразований, выполненных в задании 11.8.1 (в том числе, заполнение пропусков)."

Stepan  9 days ago
получилось. по-моему все дело было в inplace = True
:tada:
1

Ольга Евсикова Mar 29th at 11:37 AM
@Марина Архипцева (эксперт)
Здравствуйте! Помогите, пожалуйста, с заданием 12.4.2:
Используйте оригинальные данные log.csv, столбец time.
Подсказка: можно использовать value_counts().
Найдите месяц, который встречался в данных реже всего. Введите ответ в поле ниже.
Например, 2.
Использую код:
import pandas as pd
log = pd.read_csv("log.xls")
log = log.dropna()
log.columns = ['user_id', 'time', 'bet', 'win']
log['time'] = log['time'].apply(lambda x: x[1:]) 
log.time = pd.to_datetime(log.time)
log['time'] = log.time.dt.month
log['time'].value_counts()
Выводит: 
3    57
4    51
2    16
1     9
 
Т.е. получается, что январь (1) встречался реже всего, 9 раз. Платформа ответ 1 не принимает.




3 replies

Sergey Meshcheryakov  8 days ago
Добрый день
import pandas as pd
log = pd.read_csv("log.xls", header=None) # забыли параметр header
log.columns = ['user_id', 'time', 'bet', 'win']
log = log.dropna(subset=['time']) # пропуски нужно удалить только в столбце time
log['time'] = log['time'].apply(lambda x: x[1:]) 
log.time = pd.to_datetime(log.time)
log['time'] = log.time.dt.month
log['time'].value_counts(ascending=True)
(edited)
:+1:
1


Марина Архипцева (эксперт)  8 days ago
Добрый день! Действительно пропуски надо удалить только лишь в столбце time, иначе теряем информацию и искажается ответ.

Ольга Евсикова  8 days ago
@Sergey Meshcheryakov Спасибо большое за ответ!:slightly_smiling_face:


Julija Balanova Mar 29th at 4:34 PM
Задание 12.9.1
Объеденение файла
og = pd.read_csv('/Users/jbalanova/downloads/log.csv', header=None)
log.columns = ['user_id','time','bet','win']
users = pd.read_csv('/Users/jbalanova/downloads/users.csv', encoding='koi8_r', sep ='\t')
users.columns = ['user_id', 'mail', 'geo']
# Приведем признак user_id к одному формату в обоих датасетах
users.user_id = users.user_id.apply(lambda x: x.lower())
# Избавимся от ошибок в user_id
log = log[log.user_id != '#error']
log.user_id = log.user_id.str.split(' - ').apply(lambda x: x[1])
pd.merge(log, users, on='user_id')
формирование Net
log['bet'] = log['bet'].fillna(0)
#определяем правило для заполнения столбца win
def fillna_win(row):
    if pd.isna(row.win) and row.bet == 0:
        row.win = 0
    elif pd.isna(row.win) and row.bet > 0:
        row.win = -row.bet
    else:
        row.win = row.win
    return row
#заполняем столбец по заданой формуле
log = log.apply(fillna_win, axis=1)
def new_1(win, bet):
    if win < 0:
        return win
    else:
        return win - bet
log['net'] = log.apply(lambda x: new_1(x['win'], x['bet']), axis=1)
поиск ответа для задания 9.1.
log.groupby('user_id').net.sum().median()
получается 2202
помогите пожалуйста понять, что я пропустила ?
1 reply

Марина Архипцева (эксперт)  8 days ago
Добрый день! Здесь пропуски надо просто запомнить через log.fillna(0, inplace = True)



 
Ольга Евсикова Mar 31st at 11:00 PM
@Марина Архипцева (эксперт) Здравствуйте! Помогите, пожалуйста, с функцией, заполняющей пропуски в столбце win, из 12.5
Я как только не пробовала её писать, выдаёт различные ошибки. Мне кажется это лучший из всех моих попыток, но теперь я не могу заменить значение в столбце.
import pandas as pd
log = pd.read_csv("log.xls", header=None)
log.columns = ['user_id', 'time', 'bet', 'win']
def fillna_win(row):
# Нужно дописать 
   if pd.isna(row.win)==False:
       return row.win
   elif pd.isna(row.win)==True and pd.isna(row.bet)==True:
       return row.win == 0
   elif pd.isna(row.win)==True and pd.isna(row.bet)==False:
       row.win = -(row.bet)
       return row.win
# Применяем функцию 
new_win = log.apply(lambda row: fillna_win(row), axis=1) 
# Заменяем старый столбец с пропусками на новый без пропусков 
log.win = new_win.win
Выдаётся ошибка: 'Series' object has no attribute 'win'
:white_check_mark:
1

2 replies

Марина Архипцева (эксперт)  6 days ago
Добрый день! Последняя строка должна быть в таком виде: log.win = new_win . Обратите внимание, что в одном из вариантов ваша функция возвращает логическое значение: return row.win == 0 , здесь должно быть возвращено просто 0. Вот такие условия pd.isna(row.win)==True  можно упростить до pd.isna(row.win) , т.к. оно у вас и так логическое и дополнительно сравнивать с True не надо.
:+1:
1


Ольга Евсикова  3 days ago
@Марина Архипцева (эксперт) Спасибо большое за ответ!
log.win = new_win.win было в условии прописано, видимо на внимательность студентов))
я потом передала по-другому функцию и уже увидела это..
:handshake:
1

      